<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>Simple_grid_demo</title>
    </head>
    <body>
        <h1>Dumb grid demo!</h1>

        <div id="gridHolder"></div>
    </body>
    <script src="https://raw.github.com/kriszyp/put-selector/master/put.js"></script>
    <!-- I hate the DOM -->
    <script>
        var holder = document.querySelector('#gridHolder');
        var table = put(holder, 'table');
        var theader = put(table, 'thead > tr');
        var tbody = put(table, 'tbody');
        var theDatas = [
            {alpha:1, beta:2, charlie:3, delta:4, echo:2, nested:{heart:'dude', burn:'sweet'}, kilo:'kilo1', bob:'bob2'},
            {alpha:1, beta:2, charlie:3},
            {alpha:1, beta:2, charlie:3, delta:4},
            {alpha:1, beta:2, charlie:3, kilo:6, nested:{heart:'tommy', burn:'gavin'}},
            {alpha:1, beta:2, charlie:3, kilo:6, bob:42},
            {alpha:1, charlie:3, kilo:6},
            {alpha:1}
        ];
        var seenHash = {};
        function header(key, prefix) {
            if (!(key in seenHash)) {
                seenHash[(typeof prefix === 'undefined' ? '' : prefix + '.') + key] = true;
                put(theader, 'th', (typeof prefix === 'undefined' ? '' : prefix + '.') + key);
            }
        }

        function displayValue(valueRow, item, field) {
            var value = item;
            if (field.indexOf('.') != -1) {
//                value = item[field.split('.')[0]];
//                field = field.slice(field.indexOf('.'));
                while(field.indexOf('.') != -1) {
                    var key = field.split('.')[0];
                    value = value[key];
                    field = field.slice(field.indexOf('.') + 1);
                }
                value = typeof value === 'undefined' ? '' : value[field];
            } else {
                value = item[field];
            }
            put(valueRow, 'td', typeof value === 'undefined' ? '' : value);
        }

        function buildTable(item, prefix) {
            Object.keys(item).forEach(function (key) {
                if (typeof item[key] == "object") {
                    for (var data in item[key]) {
                        header(data, key);
                    }
                } else {
                    header(key, prefix);
                }
            });
            var valueRow = put('tr');
            Object.keys(seenHash).forEach(function (field) {
                displayValue(valueRow, item, field);
            });
            put(tbody, valueRow);
        }
        theDatas.forEach(function (data) {
            buildTable(data);
        });


    </script>
</html>
